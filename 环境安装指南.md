# 发票管理系统 - 环境安装指南

## 系统要求

### 硬件要求
- **内存**: 至少 2GB RAM
- **存储**: 至少 1GB 可用空间
- **处理器**: 双核以上

### 软件要求
- **操作系统**: Windows 10/11, macOS 10.14+, Ubuntu 18.04+
- **Python**: 3.8 或更高版本
- **SQLite**: 3.32.0+ (通常随Python安装)

## 环境安装步骤

### 1. 安装Python

#### Windows系统
1. 访问 [Python官网](https://www.python.org/downloads/)
2. 下载 Python 3.8+ 版本
3. 运行安装程序，**务必勾选 "Add Python to PATH"**
4. 完成安装

#### macOS系统
```bash
# 使用Homebrew安装
brew install python

# 或者从官网下载安装包
```

#### Linux系统 (Ubuntu/Debian)
```bash
sudo apt update
sudo apt install python3 python3-pip
```

### 2. 验证Python安装
打开终端/命令提示符，运行：
```bash
python --version
# 或
python3 --version
```

### 3. 下载项目代码
```bash
# 如果使用git
git clone <项目仓库地址>
cd invoice-management-system

# 或者直接下载ZIP文件并解压
```

### 4. 安装项目依赖
在项目根目录执行：

#### Windows
```bash
pip install -r requirements.txt
```

#### macOS/Linux
```bash
pip3 install -r requirements.txt
```

### 5. 依赖包说明
项目使用的核心依赖包：
- **Flask**: Web框架
- **Flask-Login**: 用户认证
- **Flask-SQLAlchemy**: 数据库ORM
- **Werkzeug**: 文件上传和安全
- **Bootstrap-Flask**: Bootstrap集成

### 6. 数据库初始化
系统会自动创建SQLite数据库文件：
```bash
# 首次运行会自动创建数据库
python app.py
```

### 7. 创建初始用户
系统会自动创建演示账户：
- **上传者**: `uploader1` / `password123`
- **管理员**: `admin1` / `password123`
- **超级管理员**: `superadmin` / `superadmin123`

### 8. 启动应用
```bash
# 开发模式（默认端口5000）
python app.py

# 或者指定端口
python app.py --port 8080
```

## 配置文件说明

### 应用配置 (app.py)
```python
# 基本配置
app.config['SECRET_KEY'] = 'your-secret-key'
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///invoices.db'
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB文件限制
```

### 自定义配置
如需修改配置，可以编辑 `app.py` 文件中的配置部分。

## 文件目录结构

```
发票管理系统/
├── app.py                 # 主应用文件
├── requirements.txt       # Python依赖包
├── instance/
│   └── invoices.db       # SQLite数据库（自动生成）
├── templates/            # HTML模板文件
│   ├── login.html
│   ├── uploader_dashboard.html
│   ├── admin_dashboard.html
│   └── superadmin_dashboard.html
├── uploads/              # 文件上传目录（自动生成）
└── md/                   # 项目文档
    ├── 项目介绍.md
    ├── 部署指南.md
    └── 环境安装指南.md
```

## 访问系统

1. 启动应用后，打开浏览器访问：
   ```
   http://localhost:5000
   ```

2. 使用以下账户登录：
   - **上传者面板**: `uploader1` / `password123`
   - **管理员面板**: `admin1` / `password123`
   - **超级管理员面板**: `superadmin` / `superadmin123`

## 故障排除

### 常见问题

#### 1. Python命令找不到
- **Windows**: 检查是否勾选"Add Python to PATH"
- **macOS/Linux**: 使用 `python3` 命令

#### 2. 端口被占用
```bash
# 使用其他端口
python app.py --port 8080
```

#### 3. 依赖安装失败
```bash
# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

#### 4. 文件上传失败
- 检查 `uploads` 目录是否存在且有写权限
- 检查文件大小是否超过16MB限制

#### 5. 数据库问题
- 删除 `instance/invoices.db` 文件重新启动应用
- 检查磁盘空间是否充足

### 日志查看
应用运行日志会显示在控制台，包含：
- 启动信息
- 用户登录记录
- 文件上传记录
- 错误信息

## 生产环境部署

### 使用Gunicorn (Linux/macOS)
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

### 使用Waitress (Windows)
```bash
pip install waitress
waitress-serve --host 0.0.0.0 --port 5000 app:app
```

### 反向代理配置 (Nginx)
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 安全建议

1. **修改默认密码**: 生产环境务必修改默认账户密码
2. **使用HTTPS**: 配置SSL证书启用HTTPS
3. **定期备份**: 定期备份数据库文件
4. **更新依赖**: 定期更新Python包到最新版本

## 技术支持

如遇问题，请检查：
1. Python版本是否符合要求
2. 所有依赖包是否成功安装
3. 端口5000是否被其他程序占用
4. 防火墙设置是否允许访问

如需进一步帮助，请提供详细的错误信息和控制台输出。

---
*最后更新: 2025年11月*
